// –°–∏—Å—Ç–µ–º–∞ —Ç–µ–º –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ Linkoo

export const cardThemes = {
    // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ —Ç–µ–º—ã
    gradient_ocean: {
        id: 'gradient_ocean',
        name: 'Ocean Wave',
        category: 'gradient',
        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
        textColor: '#ffffff',
        accentColor: '#ffffff',
        preview: 'üåä',
        popular: true,
    }, gradient_sunset: {
        id: 'gradient_sunset',
        name: 'Sunset Glow',
        category: 'gradient',
        background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
        textColor: '#ffffff',
        accentColor: '#ffffff',
        preview: 'üåÖ',
        popular: true,
    }, gradient_forest: {
        id: 'gradient_forest',
        name: 'Forest Green',
        category: 'gradient',
        background: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
        textColor: '#ffffff',
        accentColor: '#ffffff',
        preview: 'üå≤',
    }, gradient_space: {
        id: 'gradient_space',
        name: 'Space Dream',
        category: 'gradient',
        background: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
        textColor: '#1f2937',
        accentColor: '#374151',
        preview: 'üåå',
    }, gradient_fire: {
        id: 'gradient_fire',
        name: 'Fire Burst',
        category: 'gradient',
        background: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
        textColor: '#ffffff',
        accentColor: '#ffffff',
        preview: 'üî•',
    }, gradient_royal: {
        id: 'gradient_royal',
        name: 'Royal Purple',
        category: 'gradient',
        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
        textColor: '#ffffff',
        accentColor: '#ffffff',
        preview: 'üëë',
    },

    // –û–¥–Ω–æ—Ç–æ–Ω–Ω—ã–µ —Ç–µ–º—ã
    solid_midnight: {
        id: 'solid_midnight',
        name: 'Midnight Black',
        category: 'solid',
        background: '#1a1a1a',
        textColor: '#ffffff',
        accentColor: '#f3f4f6',
        preview: 'üåô',
    }, solid_ocean: {
        id: 'solid_ocean',
        name: 'Deep Ocean',
        category: 'solid',
        background: '#0ea5e9',
        textColor: '#ffffff',
        accentColor: '#ffffff',
        preview: 'üåä',
    }, solid_emerald: {
        id: 'solid_emerald',
        name: 'Emerald Green',
        category: 'solid',
        background: '#10b981',
        textColor: '#ffffff',
        accentColor: '#ffffff',
        preview: 'üíé',
    }, solid_rose: {
        id: 'solid_rose',
        name: 'Rose Pink',
        category: 'solid',
        background: '#f43f5e',
        textColor: '#ffffff',
        accentColor: '#ffffff',
        preview: 'üåπ',
    }, solid_amber: {
        id: 'solid_amber',
        name: 'Golden Amber',
        category: 'solid',
        background: '#f59e0b',
        textColor: '#ffffff',
        accentColor: '#ffffff',
        preview: 'üü°',
    }, solid_indigo: {
        id: 'solid_indigo',
        name: 'Royal Indigo',
        category: 'solid',
        background: '#6366f1',
        textColor: '#ffffff',
        accentColor: '#ffffff',
        preview: 'üîÆ',
    },

    // –°–≤–µ—Ç–ª—ã–µ —Ç–µ–º—ã
    light_minimal: {
        id: 'light_minimal',
        name: 'Clean White',
        category: 'light',
        background: '#ffffff',
        textColor: '#1f2937',
        accentColor: '#6b7280',
        preview: 'ü§ç',
        popular: true,
    }, light_cream: {
        id: 'light_cream',
        name: 'Warm Cream',
        category: 'light',
        background: '#fef7ed',
        textColor: '#92400e',
        accentColor: '#b45309',
        preview: 'üçØ',
    }, light_sky: {
        id: 'light_sky',
        name: 'Sky Blue',
        category: 'light',
        background: '#f0f9ff',
        textColor: '#0c4a6e',
        accentColor: '#0284c7',
        preview: '‚òÅÔ∏è',
    }, light_mint: {
        id: 'light_mint',
        name: 'Fresh Mint',
        category: 'light',
        background: '#f0fdf4',
        textColor: '#14532d',
        accentColor: '#16a34a',
        preview: 'üåø',
    },

    // –°—Ç–µ–∫–ª—è–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
    glass_dark: {
        id: 'glass_dark',
        name: 'Dark Glass',
        category: 'glass',
        background: 'rgba(17, 24, 39, 0.8)',
        textColor: '#ffffff',
        accentColor: '#f3f4f6',
        preview: 'üîÆ',
        backdrop: 'blur(12px)',
        border: '1px solid rgba(255, 255, 255, 0.1)',
    }, glass_light: {
        id: 'glass_light',
        name: 'Light Glass',
        category: 'glass',
        background: 'rgba(255, 255, 255, 0.8)',
        textColor: '#1f2937',
        accentColor: '#374151',
        preview: '‚ú®',
        backdrop: 'blur(12px)',
        border: '1px solid rgba(0, 0, 0, 0.1)',
    }, glass_ocean: {
        id: 'glass_ocean',
        name: 'Ocean Glass',
        category: 'glass',
        background: 'rgba(14, 165, 233, 0.8)',
        textColor: '#ffffff',
        accentColor: '#ffffff',
        preview: 'üåä',
        backdrop: 'blur(12px)',
        border: '1px solid rgba(255, 255, 255, 0.2)',
    },
};

// –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–µ–º
export const themeCategories = {
    gradient: {
        name: '–ì—Ä–∞–¥–∏–µ–Ω—Ç—ã', icon: 'üåà', description: '–Ø—Ä–∫–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã',
    }, solid: {
        name: '–û–¥–Ω–æ—Ç–æ–Ω–Ω—ã–µ', icon: 'üé®', description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞',
    }, light: {
        name: '–°–≤–µ—Ç–ª—ã–µ', icon: '‚òÄÔ∏è', description: '–°–≤–µ—Ç–ª—ã–µ –∏ —á–∏—Å—Ç—ã–µ —Ç–æ–Ω–∞',
    }, glass: {
        name: '–°—Ç–µ–∫–ª–æ', icon: 'üîÆ', description: '–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Å—Ç–µ–∫–ª—è–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã',
    },
};

// –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–º—ã
export const popularThemes = Object.values(cardThemes).filter(theme => theme.popular);

// –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–º—É –ø–æ ID
export const getThemeById = (themeId) => {
    return cardThemes[themeId] || cardThemes.light_minimal;
};

// –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–º—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
export const getThemesByCategory = (category) => {
    return Object.values(cardThemes).filter(theme => theme.category === category);
};

// –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª–∏ —Ç–µ–º—ã –∫ —ç–ª–µ–º–µ–Ω—Ç—É
export const applyThemeStyles = (theme) => {
    const styles = {
        background: theme.background, color: theme.textColor,
    };

    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–µ–∫–ª—è–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –µ—Å–ª–∏ –µ—Å—Ç—å
    if (theme.backdrop) {
        styles.backdropFilter = theme.backdrop;
        styles.WebkitBackdropFilter = theme.backdrop;
    }

    if (theme.border) {
        styles.border = theme.border;
    }

    return styles;
};

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞
export const getTextContrast = (backgroundColor) => {
    // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –µ—Å–ª–∏ —Ñ–æ–Ω —Ç—ë–º–Ω—ã–π, —Ç–µ–∫—Å—Ç —Å–≤–µ—Ç–ª—ã–π –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç
    const isDark = backgroundColor.includes('rgb(') ? backgroundColor.includes('0.8') || backgroundColor.includes('0.9') : !backgroundColor.includes('#f') && !backgroundColor.includes('light');

    return isDark ? '#ffffff' : '#1f2937';
};

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é —Ç–µ–º—É –≤ localStorage
export const saveCustomTheme = (theme) => {
    try {
        const customThemes = getCustomThemes();
        const themeId = `custom_${Date.now()}`;
        const newTheme = {
            ...theme, id: themeId, category: 'custom', isCustom: true,
        };

        customThemes[themeId] = newTheme;
        localStorage.setItem('linkoo_custom_themes', JSON.stringify(customThemes));

        return themeId;
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–º—ã:', error);
        return null;
    }
};

// –ü–æ–ª—É—á–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–µ–º—ã –∏–∑ localStorage
export const getCustomThemes = () => {
    try {
        const saved = localStorage.getItem('linkoo_custom_themes');
        return saved ? JSON.parse(saved) : {};
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–º:', error);
        return {};
    }
};

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–µ–º—ã (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ + –∫–∞—Å—Ç–æ–º–Ω—ã–µ)
export const getAllThemes = () => {
    const customThemes = getCustomThemes();
    return {...cardThemes, ...customThemes};
};

// –£–¥–∞–ª–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é —Ç–µ–º—É
export const deleteCustomTheme = (themeId) => {
    try {
        const customThemes = getCustomThemes();
        delete customThemes[themeId];
        localStorage.setItem('linkoo_custom_themes', JSON.stringify(customThemes));
        return true;
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–µ–º—ã:', error);
        return false;
    }
};

// –≠–∫—Å–ø–æ—Ä—Ç —Ç–µ–º—ã –≤ JSON
export const exportTheme = (theme) => {
    const exportData = {
        ...theme, exportedFrom: 'Linkoo', exportedAt: new Date().toISOString(),
    };

    const blob = new Blob([JSON.stringify(exportData, null, 2)], {
        type: 'application/json',
    });

    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `linkoo-theme-${theme.name.toLowerCase().replace(/\s+/g, '-')}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
};

// –ò–º–ø–æ—Ä—Ç —Ç–µ–º—ã –∏–∑ JSON
export const importTheme = async (file) => {
    try {
        const text = await file.text();
        const themeData = JSON.parse(text);

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ–º—ã
        if (!themeData.name || !themeData.background) {
            throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ —Ç–µ–º—ã');
        }

        const themeId = saveCustomTheme(themeData);
        return themeId;
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —Ç–µ–º—ã:', error);
        throw error;
    }
};
